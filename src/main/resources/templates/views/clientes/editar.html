<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/componentes/header.css}">
    <link rel="stylesheet" th:href="@{/css/componentes/footer.css}">
    <link rel="stylesheet" th:href="@{/css/clientes/editar.css}">
    <link rel="stylesheet" th:href="@{/css/main.css}">

    <title>AnimTracker - Editar Cliente</title>
    <meta name="_csrf" th:if="${_csrf != null}" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:if="${_csrf != null}" th:content="${_csrf.headerName}"/>
</head>
<body>
<div th:replace="~{componentes/header :: header('clientes')}"></div>
<div class="content">
    <main>
        <div class="at-client__page-container">
            <div class="at-client__container-fluid">

                <div th:if="${erro}" class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <span th:text="${erro}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <div th:if="${sucesso}" class="alert alert-success alert-dismissible fade show mb-3" role="alert">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <span th:text="${sucesso}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>

                <form th:action="@{/cliente/editar/{id}(id=${cliente.id})}" method="post" id="editarClienteForm">
                    <div class="at-client__actions-container">
                        <button type="submit" class="btn btn-primary at-client__btn-primary">
                            <i class="bi bi-check-circle me-2"></i>Salvar Alterações
                        </button>
                        <a class="btn btn-secondary at-client__btn-secondary" th:href="@{/cliente/{id}(id=${cliente.id})}">
                            <i class="bi bi-x-circle me-2"></i>Cancelar
                        </a>
                    </div>

                    <div class="card at-client__card">
                        <div class="row g-0">
                            <div class="col-lg-3 at-client__card-header">
                                <div class="at-client__avatar-wrapper">
                                    <div class="at-client__avatar-initials" id="clientAvatarPreview" th:text="${#strings.isEmpty(cliente.nome) ? 'E' : #strings.substring(cliente.nome,0,1)}">E</div>
                                </div>
                                <h2 class="at-client__name-preview" id="clientNamePreview" th:text="${cliente.nome ?: 'Editar Cliente'}">Editar Cliente</h2>
                            </div>
                            <div class="col-lg-9">
                                <div class="at-client__card-body">
                                    <h3 class="at-client__section-title">Informações Principais</h3>
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-6">
                                            <label for="nome" class="form-label at-client__form-label">Nome <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control at-client__form-input" id="nome" name="nome" placeholder="Nome completo do cliente" required th:value="${cliente.nome}">
                                            <div class="invalid-feedback">Por favor, informe o nome do cliente.</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="telefone_principal" class="form-label at-client__form-label">Telefone Principal</label>
                                            <input type="tel" class="form-control at-client__form-input" id="telefone_principal" name="telefone_principal" placeholder="(XX) XXXXX-XXXX" th:value="${cliente.telefone_principal}">
                                        </div>
                                    </div>
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-6">
                                            <label for="email_principal" class="form-label at-client__form-label">Email Principal</label>
                                            <input type="email" class="form-control at-client__form-input" id="email_principal" name="email_principal" placeholder="email@exemplo.com" th:value="${cliente.email_principal}">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="site" class="form-label at-client__form-label">Site</label>
                                            <input type="url" class="form-control at-client__form-input" id="site" name="site" placeholder="https://www.exemplo.com" th:value="${cliente.site}">
                                        </div>
                                    </div>
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-6">
                                            <label for="tipo" class="form-label at-client__form-label">Tipo de Cliente</label>
                                            <select class="form-select at-client__form-select" id="tipo" name="tipo">
                                                <option value="" disabled>Selecione um tipo</option>
                                                <option th:each="t : ${clientesTipos}" th:value="${t.name()}" th:text="${t.getDisplayName()}" th:selected="${t == cliente.tipo}"></option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="categoria" class="form-label at-client__form-label">Categoria</label>
                                            <select class="form-select at-client__form-select" id="categoria" name="categoria">
                                                <option value="" disabled>Selecione uma categoria</option>
                                                <option th:each="cat : ${clientesCategorias}" th:value="${cat.name()}" th:text="${cat.getDisplayName()}" th:selected="${cat == cliente.categoria}"></option>
                                            </select>
                                        </div>
                                    </div>

                                    <h3 class="at-client__section-title">Contato Adicional</h3>
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-6">
                                            <label for="nome_contato" class="form-label at-client__form-label">Nome do Contato</label>
                                            <input type="text" class="form-control at-client__form-input" id="nome_contato" name="nome_contato" placeholder="Nome do contato principal" th:value="${cliente.nome_contato}">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="cargo_contato" class="form-label at-client__form-label">Cargo do Contato</label>
                                            <input type="text" class="form-control at-client__form-input" id="cargo_contato" name="cargo_contato" placeholder="Cargo do contato" th:value="${cliente.cargo_contato}">
                                        </div>
                                    </div>
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-6">
                                            <label for="email_secundario" class="form-label at-client__form-label">Email Secundário</label>
                                            <input type="email" class="form-control at-client__form-input" id="email_secundario" name="email_secundario" placeholder="email.secundario@exemplo.com" th:value="${cliente.email_secundario}">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="telefone_secundario" class="form-label at-client__form-label">Telefone Secundário</label>
                                            <input type="tel" class="form-control at-client__form-input" id="telefone_secundario" name="telefone_secundario" placeholder="(XX) YYYYY-YYYY" th:value="${cliente.telefone_secundario}">
                                        </div>
                                    </div>

                                    <h3 class="at-client__section-title">Observações</h3>
                                    <div class="mb-0">
                                        <textarea class="form-control at-client__form-textarea" id="observacoes" name="observacoes" rows="3" placeholder="Informações adicionais sobre o cliente..." th:text="${cliente.observacoes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>
</div>
<footer th:replace="~{componentes/footer :: footer}"></footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const nomeInput = document.getElementById('nome');
        const clientNamePreview = document.getElementById('clientNamePreview');
        const clientAvatarPreview = document.getElementById('clientAvatarPreview');
        const originalClientName = clientNamePreview.textContent;
        const originalClientInitial = clientAvatarPreview.textContent;

        function updatePreview() {
            const nomeValue = nomeInput.value.trim();
            if (nomeValue) {
                clientNamePreview.textContent = nomeValue;
                clientAvatarPreview.textContent = nomeValue.charAt(0).toUpperCase();
            } else {
                clientNamePreview.textContent = originalClientName || 'Editar Cliente';
                clientAvatarPreview.textContent = originalClientInitial || 'E';
            }
        }

        if (nomeInput && clientNamePreview && clientAvatarPreview) {
            nomeInput.addEventListener('input', updatePreview);
        }

        const form = document.getElementById('editarClienteForm');
        if (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        }
    });
</script>
</body>
</html>